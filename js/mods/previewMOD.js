var previewMOD = (function(){

var layout;
var form;
var formIndex;

events.on("previewActivate", previewActivate); // * Hey, Listen * -- 'TemplateCreatorMOD.js'
events.on("addToForm", addToForm);             // * Hey, Listen * -- 'TemplateCreatorMOD.js'

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// EVENTS ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Open Window .......................................................................................................................................................

function previewActivate(){

        if(appWindow.window('previewWINDOW').isHidden()) {

            appWindow.window('previewWINDOW').show();
            appWindow.window('previewWINDOW').bringToTop();
            _parentDisable();

        }else{

          appWindow.window('previewWINDOW').bringToTop();
          
        }
      
      }

// Close window clear form - This event as well clears the form everytime the user closes out............................................................................................................................
var _closeWindow = function(){

    appWindow.attachEvent("onHide", function(win){

      
            console.log('PREVIEW CLOSED!'); 

            form.removeItem("form");
            var TGB = {type: "block", width: 1000, name:"form", blockOffset: 0, list: []};
            form.addItem("genBLOCK",TGB, 1);
        
    });
}

// Adding data to form from grid ..............................................................................................................................................

function addToForm(data){ 

    // Standard GL:
    var dataFromGrid ={type:'input', name:data[0].GL, label:data[0].lineItem, position:"label-left", labelWidth:150, numberFormat:"0,000.00"};
    form.addItem("form", dataFromGrid,formIndex);

    formIndex++;

    if(data[1] != null){

        var sub = data[1];

        for(var i = 0; i < sub.length; i++){

    // GL Descriptions:

            var dataFROMSub = {type:'input', name:sub[i].id_1, label:sub[i].id_1, position:"label-left", labelWidth:150, numberFormat:"0,000.00", offsetLeft: "50"};
            form.addItem("form", dataFROMSub,formIndex);
            formIndex++;

        }
     }

}

// Disable Background of Window .......................................................................................................................................................

var _parentDisable = function(){

	appWindow.window('previewWINDOW').setModal(true); // Disables Background.

}



//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

var init = function(win){

/////////////////////
///   WINDOW     /// 
///////////////////

appWindow = win;
appWindow.createWindow('previewWINDOW', 400, 30, 610, 750);
appWindow.window('previewWINDOW').setText("");
formIndex = 1;

/////////////////////
///   LAYOUT     /// 
///////////////////

layout = appWindow.window('previewWINDOW').attachLayout("1C");
layout.cells('a').setText("Form Layout");


/////////////////////
///   FORMS      /// 
///////////////////

form = layout.cells("a").attachForm(crForms.gridToFormGenerated);



appWindow.window('previewWINDOW').hide();

/////////////////////
//   INIT EVENTS  //
///////////////////
 _closeWindow();





    };

    return{
        init: init
    }
})();